if("undefined"==typeof jQuery.ccjs)throw new Error("Please include the ccjs initializer file");!function(a){var b='<div class="slds-pill__container slds-hide"></div>',c='<span class="slds-pill"><a href="javascript:void(0)" class="slds-pill__label"><svg aria-hidden="true" class="{{objectIconClass}} slds-icon slds-pill__icon{{hasIcon}}"><use xlink:href="{{objectIconUrl}}"></use></svg><span class="slds-pill__label">{{selectedResultLabel}}</span><button class="slds-button slds-button--icon-bare slds-pill__remove"><svg aria-hidden="true" class="slds-button__icon"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#close"></use></svg><span class="slds-assistive-text">Remove</span></button></a></span>',d='<span class="slds-pill"><a href="javascript:void(0)" class="slds-pill__label"><img class="{{objectIconClass}} slds-icon slds-pill__icon{{hasIcon}}" src="{{objectIconUrl}}"/><span class="slds-pill__label">{{selectedResultLabel}}</span><button class="slds-button slds-button--icon-bare slds-pill__remove"><svg aria-hidden="true" class="slds-button__icon"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#close"></use></svg><span class="slds-assistive-text">Remove</span></button></a></span>',e='<div class="slds-lookup__menu" role="listbox"><ul class="slds-lookup__list" role="presentation"></ul></div>',f='<div class="slds-lookup__item"><button class="slds-button"><svg aria-hidden="true" class="slds-icon-text-default slds-icon slds-icon--small{{hasIcon}}"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#search"></use></svg>&quot;{{searchTerm}}&quot; in {{objectPluralLabel}}</button></div>',g='<div class="slds-lookup__item"><button class="slds-button"><svg aria-hidden="true" class="slds-icon-text-default slds-icon slds-icon--small{{hasIcon}}"><use xlink:href="{{assetsLocation}}/assets/icons/utility-sprite/svg/symbols.svg#add"></use></svg>Add {{objectLabel}}</button></div>',h='<li class="slds-lookup__item"><a id="{{resultId}}" href="javascript:void(0)" role="option"><svg aria-hidden="true" class="{{objectIconClass}} slds-icon slds-icon--small{{hasIcon}}"><use xlink:href="{{objectIconUrl}}"></use></svg>{{resultLabel}}</a></li>',i='<li class="slds-lookup__item"><a id="{{resultId}}" href="javascript:void(0)" role="option"><img class="{{objectIconClass}} slds-icon slds-icon--small{{hasIcon}}" src="{{objectIconUrl}}"/>{{resultLabel}}</a></li>',j=function(c,d){this.$el=a(c),this.$lookupContainer=this.$el.closest(".slds-lookup"),this.isSingle="single"===this.$lookupContainer.data("select"),this.settings=d,this.isSingle?this.$singleSelect=a(b).insertBefore(this.$el):(this.$multiSelect=a(b).appendTo(this.$lookupContainer.find(".slds-form-element")),this.selectedResults=[]),this.isStringEmpty(d.searchTerm)?d.initialSelection&&this.setSelection(d.initialSelection):(this.$el.val(d.searchTerm),this.setSingleSelect()),this.initLookup()};j.prototype={constructor:j,isStringEmpty:function(a){return null===a||"undefined"==typeof a||""===a.trim()},initLookup:function(){var b=this;this.$el.on("focus",this,this.runSearch).on("keyup",this,this.runSearch).on("blur",this,this.handleBlur),this.$lookupContainer.on("keyup",function(c){c.stopPropagation();var d=a(this).find("a:focus");27===c.keyCode&&b.$el.blur(),40===c.keyCode&&(d.length>0?d.parent().next().find("a").focus():a(this).find(".slds-lookup__list").find("a:first").focus()),38===c.keyCode&&(d.length>0?d.parent().prev().find("a").focus():a(this).find(".slds-lookup__list").find("a:last").focus())})},runSearch:function(a){var b=a.data,c=b.$el.val();b.isStringEmpty(c)?b.getDefaultResults():b.getSearchTermResults(c)},setMultiSelect:function(b){var e=this,f=this.$multiSelect.html(""),g=this.$lookupContainer,h=e.settings.useImgTag?d:c;b.length>0?(b.forEach(function(b){var c=a(h.replace("{{objectIconUrl}}",e.settings.objectIconUrl).replace("{{objectIconClass}}",e.settings.objectIconClass).replace("{{hasIcon}}",""!==e.settings.objectIconUrl?"":" slds-hide").replace("{{assetsLocation}}",e.settings.assetsLocation).replace("{{selectedResultLabel}}",b.label));c.removeClass("slds-pill--bare").attr("id",b.id).on("click","a, button",e,e.clearMultiSelectResult),f.append(c)}),f.addClass("slds-show").removeClass("slds-hide"),g.addClass("slds-has-selection")):(f.html(""),f.addClass("slds-hide").removeClass("slds-show"),g.removeClass("slds-has-selection"))},setSingleSelect:function(a){var b=this,e=a||"",f=b.settings.useImgTag?d:c;this.$singleSelect.html(f.replace("{{objectIconUrl}}",this.settings.objectIconUrl).replace("{{objectIconClass}}",b.settings.objectIconClass).replace("{{hasIcon}}",""!==b.settings.objectIconUrl?"":" slds-hide").replace("{{assetsLocation}}",this.settings.assetsLocation).replace("{{selectedResultLabel}}",e)),a?(this.$singleSelect.addClass("slds-show").removeClass("slds-hide"),this.$el.addClass("slds-hide"),this.$lookupContainer.addClass("slds-has-selection"),this.$singleSelect.one("click","button",this,this.clearSingleSelect)):(this.$singleSelect.addClass("slds-hide").removeClass("slds-show"),this.$el.val("").removeClass("slds-hide"),this.$lookupContainer.removeClass("slds-has-selection"),window.setTimeout(function(){b.$el.focus()},100))},getSearchTermResults:function(a){var b=this;if(this.settings.items.length>0)this.searchResults=this.settings.items.filter(function(b){return null!==b.label.toLowerCase().match(a.toLowerCase())}),this.renderSearchResults();else{var c=function(a){b.searchResults=a,b.renderSearchResults()};this.settings.filledSearchTermQuery(a,c)}},getDefaultResults:function(){var a=this;if(this.settings.items.length>0)this.searchResults=this.settings.items,this.renderSearchResults();else{var b=function(b){a.searchResults=b,a.renderSearchResults()};this.settings.emptySearchTermQuery(b)}},renderSearchResults:function(){this.closeSearchDropdown();var b=a(e),c=b.find("ul.slds-lookup__list"),d=this.$el.val(),j=this;!this.isStringEmpty(d)&&d.length>1&&this.settings.showSearch===!0&&c.before(f.replace("{{searchTerm}}",d).replace("{{objectPluralLabel}}",this.settings.objectPluralLabel).replace("{{assetsLocation}}",a.ccjs.assetsLocation)),this.searchResults.forEach(function(b){var d,e=j.settings.useImgTag?i:h;if(j.isSingle)d=c.append(e.replace("{{resultLabel}}",b.label).replace("{{hasIcon}}",""!==j.settings.objectIconUrl?"":" slds-hide").replace("{{resultId}}",b.id).replace("{{objectIconUrl}}",j.settings.objectIconUrl).replace("{{objectIconClass}}",j.settings.objectIconClass));else if(j.selectedResults){var f=j.selectedResults.map(function(a){return a.id});(0===f.length||-1===f.indexOf(b.id))&&(d=c.append(e.replace("{{resultLabel}}",b.label).replace("{{hasIcon}}",""!==j.settings.objectIconUrl?"":" slds-hide").replace("{{resultId}}",b.id).replace("{{objectIconUrl}}",j.settings.objectIconUrl).replace("{{objectIconClass}}",j.settings.objectIconClass)))}d&&d.find("a").on("focus",function(){j.$el.attr("aria-activedescendant",a(this).attr("id"))}).on("blur",j,j.handleBlur)}),this.settings.clickAddFunction&&c.after(g.replace("{{hasIcon}}"," slds-icon").replace("{{objectLabel}}",this.settings.objectLabel).replace("{{assetsLocation}}",a.ccjs.assetsLocation)),c.one("click","a",this,this.clickResult),this.$lookupSearchContainer=b,b.appendTo(this.$lookupContainer),this.$el.attr("aria-expanded","true")},closeSearchDropdown:function(){this.$lookupSearchContainer&&(this.$lookupSearchContainer.remove(),this.$lookupSearchContainer=null),this.$el.attr("aria-expanded","false"),this.$el.attr("aria-activedescendant",null)},handleBlur:function(b){var c=b.data;window.setTimeout(function(){0===a(b.relatedTarget).closest(".slds-lookup__menu").length&&c.$lookupSearchContainer&&c.closeSearchDropdown()},250)},clickResult:function(b){var c=b.data,d=a(this).attr("id");c.selectResult(d)},selectResult:function(a){var b=this.searchResults.filter(function(b){return b.id==a});this.closeSearchDropdown(),this.isSingle?(this.selectedResult=b.length>0?b[0]:null,this.setSingleSelect(this.selectedResult.label)):b.length>0&&(this.selectedResults.push(b[0]),this.setMultiSelect(this.selectedResults),this.$el.val("")),this.isSingle?this.settings.onChange(this.selectedResult,!0):this.settings.onChange(this.selectedResults,!0)},clearSingleSelect:function(a){var b=a.data;b.selectedResult=null,b.setSingleSelect(),b.settings.onChange(selectResult,!1)},clearMultiSelectResult:function(b){var c,d=b.data,e=a(this).closest("span.slds-pill"),f=e.attr("id");d.selectedResults.forEach(function(a,b){a.id==f&&(c=b)}),"undefined"!=typeof c&&null!==c&&(d.selectedResults.splice(c,1),d.setMultiSelect(d.selectedResults),d.settings.onChange(d.selectedResults,!1))},getSelection:function(){return this.isSingle?this.selectedResult||null:this.selectedResults||null},setSelection:function(a){var b=this;if(!a||"object"!=typeof a)throw new Error("setSelection must be called with either a valid result object or an array of result objects.");a instanceof Array?(this.searchResults=a,this.selectedResults=[],a.forEach(function(a){b.selectResult(a.id)})):(this.selectedResult=null,this.searchResults=[a],b.selectResult(a.id))}},a.fn.lookup=function(b){var c,d=arguments,e=a.extend({assetsLocation:a.ccjs.assetsLocation,objectPluralLabel:"Objects",objectLabel:"Object",useImgTag:!1,objectIconUrl:"/assets/icons/standard-sprite/svg/symbols.svg#account",objectIconClass:"slds-icon-standard-account",searchTerm:"",items:[],emptySearchTermQuery:function(a){a([])},filledSearchTermQuery:function(a,b){b([])},clickAddFunction:null,onChange:function(){},initialSelection:null,showSearch:!1},"object"==typeof b?b:{});if(this.each(function(){var f=a(this),g=f.data("ccjs-lookup");if(!g){var h=new j(this,e);f.data("ccjs-lookup",g=h)}"string"==typeof b&&(c=g[b](d[1],d[2]))}),void 0===c||c instanceof j)return this;if(this.length>1)throw new Error("Using only allowed for the collection of a single element ("+option+" function)");return c}}(jQuery);